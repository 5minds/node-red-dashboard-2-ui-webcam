(function(r,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("vuex"),require("vue")):typeof define=="function"&&define.amd?define(["exports","vuex","vue"],d):(r=typeof globalThis<"u"?globalThis:r||self,d(r["ui-webcam"]={},r.vuex,r.Vue))})(this,function(r,d,t){"use strict";const l=(o,e)=>{const i=o.__vccOpts||o;for(const[c,n]of e)i[c]=n;return i},m={name:"UIWebcam",inject:["$socket"],props:{id:{type:String,required:!0},props:{type:Object,default:()=>({})},state:{type:Object,default:()=>({enabled:!1,visible:!1})}},data(){return{imageData:null,cameraDevices:[],selectedDevice:null,cameraIsOn:!1}},computed:{...d.mapState("data",["messages"])},methods:{async startWebcam(){try{const e=(await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="videoinput");e.length>0?(this.cameraIsOn=!0,this.cameraDevices=e,this.selectedDevice=e[0].deviceId,await this.openCamera()):console.error("No video input devices found.")}catch(o){console.error("Error accessing media devices:",o)}},async openCamera(){if(this.selectedDevice==="off")this.stopWebcam(),this.cameraIsOn=!1;else{const o=this.$refs.video,e={video:{deviceId:this.selectedDevice}};try{const i=await navigator.mediaDevices.getUserMedia(e);o&&o instanceof HTMLVideoElement?(o.srcObject=i,o.play()):console.error("Video element not found or not an instance of HTMLVideoElement.")}catch(i){console.error("Error accessing webcam:",i)}}},stopWebcam(){var e;const o=(e=this.$refs.video.srcObject)==null?void 0:e.getTracks();o&&o.forEach(i=>i.stop())},captureImage(){const o=this.$refs.video,e=this.$refs.canvas,i=e.getContext("2d");if(o&&o.readyState===o.HAVE_ENOUGH_DATA){const c=o.videoWidth,n=o.videoHeight;e.width=c,e.height=n,i.drawImage(o,0,0,c,n),this.imageData=e.toDataURL("image/png"),this.send(this.imageData),setTimeout(()=>{i.clearRect(0,0,c,n)},500)}else console.error("Video element not ready or not found.")},send(o){this.$socket.emit("widget-action",this.id,{payload:o})},async changeCamera(){this.stopWebcam(),await this.openCamera()}},mounted(){},beforeUnmount(){var o,e;(o=this.$socket)==null||o.off("widget-load:"+this.id),(e=this.$socket)==null||e.off("msg-input:"+this.id),this.stopWebcam()}},p={class:"ui-webcam-wrapper"},g={style:{background:"black","min-height":"100%",width:"100%",display:"flex","align-items":"center","justify-content":"center",position:"relative"}},h={width:"100%",height:"100%",ref:"video",playsinline:"","webkit-playsinline":"",muted:""},f={style:{"z-index":"1",position:"absolute",width:"100%",height:"100%"},ref:"canvas"},u=["value"],b=t.createElementVNode("option",{value:"off"},"Off Camera",-1);function k(o,e,i,c,n,s){return t.openBlock(),t.createElementBlock("div",p,[t.createElementVNode("div",g,[t.createElementVNode("video",h,null,512),t.createElementVNode("canvas",f,null,512),n.cameraIsOn==!1?(t.openBlock(),t.createElementBlock("button",{key:0,style:{position:"absolute","margin-left":"auto","z-index":"2",right:"auto",background:"rgb(255, 255, 255)",border:"none",padding:"10px","border-radius":"50%",cursor:"pointer","box-shadow":"rgba(0, 0, 0, 0.1) 0px 2px 4px"},onClick:e[1]||(e[1]=(...a)=>s.captureImage&&s.captureImage(...a))},[t.createElementVNode("img",{onClick:e[0]||(e[0]=(...a)=>s.startWebcam&&s.startWebcam(...a)),src:"https://www.freepnglogos.com/uploads/camera-logo-png/camera-symbol-icon-25.png",height:"20",width:"20",alt:"Capture Image"})])):t.createCommentVNode("",!0),n.cameraIsOn?(t.openBlock(),t.createElementBlock("button",{key:1,style:{position:"absolute","margin-left":"auto","z-index":"2","margin-top":"60%",right:"auto",background:"rgb(255, 255, 255)",border:"none",padding:"10px","border-radius":"50%",cursor:"pointer","box-shadow":"rgba(0, 0, 0, 0.1) 0px 2px 4px"},onClick:e[3]||(e[3]=(...a)=>s.captureImage&&s.captureImage(...a))},[t.createElementVNode("img",{onClick:e[2]||(e[2]=(...a)=>s.captureImage&&s.captureImage(...a)),src:"https://www.freepnglogos.com/uploads/camera-logo-png/camera-symbol-icon-25.png",height:"20",width:"20",alt:"Capture Image"})])):t.createCommentVNode("",!0)]),n.cameraDevices.length>1?t.withDirectives((t.openBlock(),t.createElementBlock("select",{key:0,"onUpdate:modelValue":e[4]||(e[4]=a=>n.selectedDevice=a),onChange:e[5]||(e[5]=(...a)=>s.changeCamera&&s.changeCamera(...a))},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.cameraDevices,a=>(t.openBlock(),t.createElementBlock("option",{key:a.deviceId,value:a.deviceId},t.toDisplayString(a.label),9,u))),128)),b],544)),[[t.vModelSelect,n.selectedDevice]]):t.createCommentVNode("",!0)])}const v=l(m,[["render",k]]);r.UIWebcam=v,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
