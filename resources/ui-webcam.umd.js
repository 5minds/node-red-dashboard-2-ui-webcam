(function(r,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("vuex"),require("vue")):typeof define=="function"&&define.amd?define(["exports","vuex","vue"],d):(r=typeof globalThis<"u"?globalThis:r||self,d(r["ui-webcam"]={},r.vuex,r.Vue))})(this,function(r,d,o){"use strict";const l=(t,e)=>{const i=t.__vccOpts||t;for(const[c,s]of e)i[c]=s;return i},m={name:"UIWebcam",inject:["$socket"],props:{id:{type:String,required:!0},props:{type:Object,default:()=>({})},state:{type:Object,default:()=>({enabled:!1,visible:!1})}},data(){return{imageData:null,cameraDevices:[],selectedDevice:null,cameraIsOn:!1}},computed:{...d.mapState("data",["messages"])},methods:{async startWebcam(){try{const e=(await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="videoinput");e.length>0?(this.cameraIsOn=!0,this.cameraDevices=e,this.selectedDevice=e[0].deviceId,await this.openCamera()):console.error("No video input devices found.")}catch(t){console.error("Error accessing media devices:",t)}},async openCamera(){if(this.selectedDevice==="off")this.stopWebcam(),this.cameraIsOn=!1;else{const t=this.$refs.video,e={video:{deviceId:this.selectedDevice}};try{const i=await navigator.mediaDevices.getUserMedia(e);t&&t instanceof HTMLVideoElement?(t.srcObject=i,t.play()):console.error("Video element not found or not an instance of HTMLVideoElement.")}catch(i){console.error("Error accessing webcam:",i)}}},stopWebcam(){var e;const t=(e=this.$refs.video.srcObject)==null?void 0:e.getTracks();t&&t.forEach(i=>i.stop())},captureImage(){const t=this.$refs.video,e=this.$refs.canvas,i=e.getContext("2d");if(t&&t.readyState===t.HAVE_ENOUGH_DATA){const c=t.videoWidth,s=t.videoHeight;e.width=c,e.height=s,i.drawImage(t,0,0,c,s),this.imageData=e.toDataURL("image/png"),this.send(this.imageData),setTimeout(()=>{i.clearRect(0,0,c,s)},500)}else console.error("Video element not ready or not found.")},send(t){this.$socket.emit("widget-action",this.id,{payload:t})},async changeCamera(){this.stopWebcam(),await this.openCamera()}},mounted(){},beforeUnmount(){var t,e;(t=this.$socket)==null||t.off("widget-load:"+this.id),(e=this.$socket)==null||e.off("msg-input:"+this.id),this.stopWebcam()}},p=t=>(o.pushScopeId("data-v-4e8ec778"),t=t(),o.popScopeId(),t),g={class:"ui-webcam-wrapper"},h={style:{background:"black","min-height":"100%",width:"100%",display:"flex","align-items":"center","justify-content":"center",position:"relative"}},f={width:"100%",height:"100%",ref:"video",playsinline:"","webkit-playsinline":"",muted:""},u={style:{"z-index":"1",position:"absolute",width:"100%",height:"100%"},ref:"canvas"},b=["value"],k=p(()=>o.createElementVNode("option",{value:"off"},"Off Camera",-1));function v(t,e,i,c,s,n){return o.openBlock(),o.createElementBlock("div",g,[o.createElementVNode("div",h,[o.createElementVNode("video",f,null,512),o.createElementVNode("canvas",u,null,512),s.cameraIsOn==!1?(o.openBlock(),o.createElementBlock("button",{key:0,style:{position:"absolute","margin-left":"auto","z-index":"2",right:"auto",background:"rgb(255, 255, 255)",border:"none",padding:"10px","border-radius":"50%",cursor:"pointer","box-shadow":"rgba(0, 0, 0, 0.1) 0px 2px 4px"},onClick:e[1]||(e[1]=(...a)=>n.captureImage&&n.captureImage(...a))},[o.createElementVNode("img",{onClick:e[0]||(e[0]=(...a)=>n.startWebcam&&n.startWebcam(...a)),src:"https://www.freepnglogos.com/uploads/camera-logo-png/camera-symbol-icon-25.png",height:"20",width:"20",alt:"Capture Image"})])):o.createCommentVNode("",!0),s.cameraIsOn?(o.openBlock(),o.createElementBlock("button",{key:1,style:{position:"absolute","margin-left":"auto","z-index":"2","margin-top":"60%",right:"auto",background:"rgb(255, 255, 255)",border:"none",padding:"10px","border-radius":"50%",cursor:"pointer","box-shadow":"rgba(0, 0, 0, 0.1) 0px 2px 4px"},onClick:e[3]||(e[3]=(...a)=>n.captureImage&&n.captureImage(...a))},[o.createElementVNode("img",{onClick:e[2]||(e[2]=(...a)=>n.captureImage&&n.captureImage(...a)),src:"https://www.freepnglogos.com/uploads/camera-logo-png/camera-symbol-icon-25.png",height:"20",width:"20",alt:"Capture Image"})])):o.createCommentVNode("",!0)]),s.cameraDevices.length>1?o.withDirectives((o.openBlock(),o.createElementBlock("select",{key:0,"onUpdate:modelValue":e[4]||(e[4]=a=>s.selectedDevice=a),onChange:e[5]||(e[5]=(...a)=>n.changeCamera&&n.changeCamera(...a))},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(s.cameraDevices,a=>(o.openBlock(),o.createElementBlock("option",{key:a.deviceId,value:a.deviceId},o.toDisplayString(a.label),9,b))),128)),k],544)),[[o.vModelSelect,s.selectedDevice]]):o.createCommentVNode("",!0)])}const y=l(m,[["render",v],["__scopeId","data-v-4e8ec778"]]);r.UIWebcam=y,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
